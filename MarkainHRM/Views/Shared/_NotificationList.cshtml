@model IEnumerable<OzarkLMS.Models.Notification>
@using System.Security.Claims

@if(!Model.Any())
{
    <div class="text-center py-10 bg-white dark:bg-slate-900 rounded-xl shadow-sm border border-gray-200 dark:border-slate-800">
        <div class="w-12 h-12 bg-blue-50 dark:bg-slate-800 rounded-full flex items-center justify-center mx-auto mb-3 text-[#004B87] dark:text-blue-400">
            <i data-lucide="bell-off" class="w-6 h-6"></i>
        </div>
        <p class="text-slate-400 font-medium text-sm">You have no notifications.</p>
    </div>
}
else
{
    <div class="space-y-3" id="notification-list-container">
        @foreach(var note in Model)
        {
            <div class="note-@note.Id bg-white dark:bg-slate-900 p-4 rounded-xl shadow-sm border border-gray-200 dark:border-slate-800 flex items-start group hover:border-blue-300 dark:hover:border-blue-700 transition-all cursor-pointer relative @(note.IsRead ? "opacity-75" : "bg-blue-50/10 dark:bg-blue-900/10")"
                 onclick="handleNotificationClick(@note.Id, '@(string.IsNullOrEmpty(note.ActionUrl) ? "" : note.ActionUrl)')">
                
                <!-- Avatar -->
                <div class="mr-3 mt-1">
                    <div class="w-8 h-8 rounded-full bg-[#004B87] dark:bg-blue-600 text-white flex items-center justify-center font-bold text-xs shadow-sm ring-2 ring-white dark:ring-slate-800">
                        @(note.Sender?.Username.Substring(0, 1).ToUpper() ?? "S")
                    </div>
                </div>
                
                <!-- Content -->
                <div class="flex-1 pr-6">
                    <div class="flex justify-between items-start">
                         <h3 class="font-bold text-slate-800 dark:text-white text-sm">@note.Title</h3>
                         <span class="text-[10px] text-slate-400 dark:text-slate-500 whitespace-nowrap ml-2">@note.SentDate.ToLocalTime().ToShortDateString()</span>
                    </div>
                    <p class="text-slate-600 dark:text-slate-300 mt-0.5 leading-snug text-xs line-clamp-2">@note.Message</p>
                </div>

                <!-- Unread Indicator (Red Dot) -->
                @if(!note.IsRead)
                {
                     <div class="absolute top-4 right-4 dot-@note.Id">
                         <span class="w-2 h-2 bg-[#DA291C] rounded-full block shadow-sm ring-2 ring-white dark:ring-slate-900" title="Unread"></span>
                     </div>
                }

                <!-- Delete Action Wrapper -->
                <div class="absolute bottom-3 right-3 flex items-center justify-end" onclick="event.stopPropagation()">
                    <!-- Initial Trash Icon -->
                    <button onclick="toggleNoteDelete(event, @note.Id, true)" class="del-btn-@note.Id text-slate-300 hover:text-red-500 dark:text-slate-600 dark:hover:text-red-400 transition-colors p-1.5 rounded-full hover:bg-red-50 dark:hover:bg-red-900/20 opacity-0 group-hover:opacity-100" title="Delete">
                        <i data-lucide="trash-2" class="w-3.5 h-3.5"></i>
                    </button>
                    
                    <!-- Confirmation Actions -->
                    <div class="del-confirm-@note.Id hidden flex items-center bg-red-50 dark:bg-slate-800 border border-red-200 dark:border-red-900/50 rounded-full shadow-md z-10">
                        <button onclick="deleteNotification(event, @note.Id)" class="p-1.5 text-red-600 dark:text-red-400 hover:bg-red-100 dark:hover:bg-red-900/30 rounded-full transition-colors" title="Confirm">
                            <i data-lucide="check" class="w-3.5 h-3.5"></i>
                        </button>
                        <button onclick="toggleNoteDelete(event, @note.Id, false)" class="p-1.5 text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 rounded-full transition-colors" title="Cancel">
                            <i data-lucide="x" class="w-3.5 h-3.5"></i>
                        </button>
                    </div>
                </div>
            </div>
        }
    </div>
}
