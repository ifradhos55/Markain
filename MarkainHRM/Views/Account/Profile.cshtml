@model OzarkLMS.ViewModels.UserProfileViewModel

@{
    ViewData["Title"] = "My Profile";
    if (Model.User == null) return; // Safety check
}

<div class="max-w-6xl mx-auto py-10 px-6">
    
    <!-- Profile Header -->
    <!-- Profile Header -->
    <div class="bg-white dark:bg-slate-800 rounded-xl shadow-lg overflow-hidden mb-8 border border-gray-100 dark:border-slate-700 relative group">
        <div class="bg-[#004B87] dark:bg-blue-900 h-32 relative">
             <div class="absolute -bottom-10 left-8 p-1 bg-white dark:bg-slate-800 rounded-full group cursor-pointer" onclick="@(ViewBag.CurrentUserId == Model.User.Id ? "document.getElementById('profile-upload-modal').classList.remove('hidden')" : "")">
                 @if(!string.IsNullOrEmpty(Model.User.ProfilePictureUrl))
                 {
                     <img src="@(Model.User.ProfilePictureUrl + (Model.User.ProfilePictureUrl.Contains("?") ? "&" : "?") + "v=" + DateTime.UtcNow.Ticks)" alt="Profile" class="w-24 h-24 rounded-full object-cover border-4 border-white dark:border-slate-800 shadow-md transform group-hover:scale-105 transition-transform" />
                 }
                 else
                 {
                    <div class="w-24 h-24 rounded-full bg-slate-200 dark:bg-slate-700 flex items-center justify-center text-3xl font-bold text-slate-500 dark:text-slate-300 border-4 border-white dark:border-slate-800 shadow-md">
                        @(Model.User.Username.Substring(0,1).ToUpper())
                    </div>
                 }
                 @if(ViewBag.CurrentUserId == Model.User.Id)
                 {
                     <div class="absolute inset-0 bg-black/50 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
                         <i data-lucide="camera" class="w-6 h-6 text-white"></i>
                     </div>
                 }
             </div>
        </div>
        <div class="pt-12 pb-6 px-8 flex justify-between items-start">
            <div>
                <h1 class="text-3xl font-bold text-slate-800 dark:text-white">@Model.User.Username</h1>
                <div class="flex items-center space-x-2 mt-2">
                    <span class="inline-block px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300">
                        @Model.User.Role
                    </span>
                    <div class="flex items-center space-x-4 ml-4 text-sm text-slate-600 dark:text-slate-400">
                        <span><strong class="text-slate-900 dark:text-white">@Model.FollowersCount</strong> Followers</span>
                        <span><strong class="text-slate-900 dark:text-white">@Model.FollowingCount</strong> Following</span>
                    </div>
                </div>
                
                <!-- Bio Section -->
                <div class="mt-4 max-w-2xl">
                    @if(string.IsNullOrEmpty(Model.User.Bio))
                    {
                        @if(ViewBag.CurrentUserId == Model.User.Id)
                        {
                            <button onclick="document.getElementById('edit-bio-form').classList.remove('hidden'); this.classList.add('hidden')" class="text-sm text-slate-400 hover:text-blue-600 italic flex items-center">
                                <i data-lucide="plus" class="w-3 h-3 mr-1"></i> Add a bio...
                            </button>
                        }
                    }
                    else
                    {
                        <p class="text-slate-600 dark:text-slate-300">@Model.User.Bio</p>
                        @if(ViewBag.CurrentUserId == Model.User.Id)
                        {
                             <button onclick="document.getElementById('edit-bio-form').classList.remove('hidden')" class="text-xs text-blue-600 hover:underline mt-1">Edit Bio</button>
                        }
                    }
                    
                     @if(ViewBag.CurrentUserId == Model.User.Id)
                     {
                        <form id="edit-bio-form" asp-action="UpdateBio" method="post" class="mt-2 hidden">
                            <textarea name="bio" rows="2" class="w-full text-sm rounded-lg border-gray-300 focus:border-blue-500 focus:ring-blue-500 dark:bg-slate-700 dark:border-slate-600 dark:text-white" placeholder="Tell us about yourself...">@Model.User.Bio</textarea>
                            <div class="flex justify-end space-x-2 mt-2">
                                <button type="button" onclick="document.getElementById('edit-bio-form').classList.add('hidden')" class="text-xs text-slate-500 hover:text-slate-700">Cancel</button>
                                <button type="submit" class="px-3 py-1 bg-blue-600 text-white text-xs font-bold rounded-lg hover:bg-blue-700">Save</button>
                            </div>
                        </form>
                     }
                </div>
            </div>
            
            <div class="flex space-x-3">
                @if(ViewBag.CurrentUserId == Model.User.Id)
                {
                    <button onclick="document.getElementById('profile-upload-modal').classList.remove('hidden')" class="px-4 py-2 bg-slate-100 hover:bg-slate-200 dark:bg-slate-700 dark:hover:bg-slate-600 text-slate-700 dark:text-slate-200 rounded-lg text-sm font-bold transition-colors">
                        Edit Profile
                    </button>
                }
                else
                {
                    <form asp-action="ToggleFollow" method="post" asp-route-targetUserId="@Model.User.Id">
                        @if(Model.IsFollowing)
                        {
                             <button type="submit" class="px-4 py-2 bg-slate-100 hover:bg-red-50 text-slate-700 hover:text-red-600 border border-slate-200 rounded-lg text-sm font-bold transition-colors flex items-center">
                                 <i data-lucide="user-minus" class="w-4 h-4 mr-2"></i> Unfollow
                             </button>
                        }
                        else
                        {
                             <button type="submit" class="px-4 py-2 bg-[#004B87] hover:bg-blue-700 text-white rounded-lg text-sm font-bold transition-colors shadow-sm flex items-center">
                                 <i data-lucide="user-plus" class="w-4 h-4 mr-2"></i> Follow
                             </button>
                        }
                    </form>
                    
                    <!-- Message Button -->
                    <form asp-controller="Collaboration" asp-action="StartPrivateChat" method="post" class="inline">
                        <input type="hidden" name="targetUsername" value="@Model.User.Username" />
                        <button type="submit" class="px-4 py-2 bg-slate-100 hover:bg-slate-200 dark:bg-slate-700 dark:hover:bg-slate-600 text-slate-700 dark:text-slate-200 rounded-lg text-sm font-bold transition-colors">
                            Message
                        </button>
                    </form>
                }
            </div>
        </div>
    </div>

    <!-- Tabs Navigation -->
    <div class="flex border-b border-gray-200 dark:border-slate-700 mb-8">
        <button id="tab-recent" onclick="switchTab('recent')" class="px-6 py-3 text-sm font-bold text-[#004B87] dark:text-blue-400 border-b-2 border-[#004B87] dark:border-blue-400 transition-colors">
            Recent Activity
        </button>
        <button id="tab-academic" onclick="switchTab('academic')" class="px-6 py-3 text-sm font-bold text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-300 border-b-2 border-transparent transition-colors">
            Academic Activities
        </button>
    </div>

    <!-- Recent Activities Tab -->
    <div id="content-recent" class="mb-10">
        @if(!Model.Posts.Any())
        {
             <div class="text-center py-12 bg-gray-50 dark:bg-slate-800/50 rounded-lg border border-dashed border-gray-200 dark:border-slate-700">
                 <p class="text-slate-500 dark:text-slate-400">No posts yet.</p>
             </div>
        }
        else
        {
            <div class="space-y-6">
                @foreach(var post in Model.Posts)
                {
                    <partial name="_Post" model="post" />
                }
            </div>
        }
    </div>
<div id="content-shared" class="mb-10 hidden">
        @if(!Model.SharedPosts.Any())
        {
             <div class="text-center py-12 bg-gray-50 dark:bg-slate-800/50 rounded-lg border border-dashed border-gray-200 dark:border-slate-700">
                 <p class="text-slate-500 dark:text-slate-400">No shared posts yet.</p>
             </div>
        }
        else
        {
            <div class="space-y-6">
                @foreach(var shared in Model.SharedPosts)
                {
                    <div class="relative group/shared">
                        @if(ViewBag.CurrentUserId == Model.User.Id)
                        {
                            <form asp-controller="Account" asp-action="RemoveSharedPost" method="post" class="absolute top-4 right-4 z-10 opacity-0 group-hover/shared:opacity-100 transition-opacity">
                                <input type="hidden" name="sharedPostId" value="@shared.Id" />
                                <button type="submit" class="p-2 bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm rounded-lg text-red-500 hover:bg-red-50 dark:hover:bg-red-900/30 transition-all border border-slate-200 dark:border-slate-700 shadow-sm" title="Remove Shared Post">
                                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                                </button>
                            </form>
                        }
                        <partial name="_Post" model="shared.Post" />
                    </div>
                }
            </div>
        }
    </div>

    <!-- Academic Activities Tab -->
    <div id="content-academic" class="hidden">
        <!-- Admin View: Instructors & Students -->
        @if(Model.User.Role == "admin")
        {
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-10">
                <!-- Instructors List -->
                <div class="bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-gray-200 dark:border-slate-700 overflow-hidden">
                    <div class="bg-slate-50 dark:bg-slate-700/50 px-6 py-4 border-b border-gray-200 dark:border-slate-700 flex justify-between items-center">
                        <h2 class="font-bold text-lg text-slate-800 dark:text-white flex items-center">
                            <i data-lucide="graduation-cap" class="w-5 h-5 mr-2 text-[#004B87] dark:text-blue-400"></i> Instructors
                        </h2>
                        <span class="bg-blue-100 text-blue-800 text-xs font-bold px-2 py-1 rounded-full">@Model.AllInstructors.Count</span>
                    </div>
                    <div class="divide-y divide-gray-100 dark:divide-slate-700">
                        @foreach(var inst in Model.AllInstructors)
                        {
                            <div class="p-4 flex items-center hover:bg-slate-50 dark:hover:bg-slate-700/30 transition-colors">
                                @if(!string.IsNullOrEmpty(inst.ProfilePictureUrl))
                                {
                                    <img src="@inst.ProfilePictureUrl" class="w-10 h-10 rounded-full object-cover mr-3 bg-gray-200" />
                                }
                                else
                                {
                                    <div class="w-10 h-10 rounded-full bg-blue-100 dark:bg-blue-900/50 flex items-center justify-center text-blue-600 dark:text-blue-300 font-bold mr-3">
                                        @(inst.Username.Substring(0,1).ToUpper())
                                    </div>
                                }
                                <div>
                                    <p class="font-bold text-slate-800 dark:text-white">@inst.Username</p>
                                    <p class="text-xs text-slate-500">Instructor</p>
                                </div>
                            </div>
                        }
                        @if(!Model.AllInstructors.Any())
                        {
                            <div class="p-8 text-center text-slate-400 text-sm">No instructors found.</div>
                        }
                    </div>
                </div>

                <!-- Students List -->
                <div class="bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-gray-200 dark:border-slate-700 overflow-hidden">
                    <div class="bg-slate-50 dark:bg-slate-700/50 px-6 py-4 border-b border-gray-200 dark:border-slate-700 flex justify-between items-center">
                        <h2 class="font-bold text-lg text-slate-800 dark:text-white flex items-center">
                            <i data-lucide="users" class="w-5 h-5 mr-2 text-emerald-600 dark:text-emerald-400"></i> Students
                        </h2>
                        <span class="bg-emerald-100 text-emerald-800 text-xs font-bold px-2 py-1 rounded-full">@Model.AllStudents.Count</span>
                    </div>
                    <div class="divide-y divide-gray-100 dark:divide-slate-700 max-h-[500px] overflow-y-auto">
                        @foreach(var std in Model.AllStudents)
                        {
                            <div class="p-4 flex items-center hover:bg-slate-50 dark:hover:bg-slate-700/30 transition-colors">
                                @if(!string.IsNullOrEmpty(std.ProfilePictureUrl))
                                {
                                    <img src="@std.ProfilePictureUrl" class="w-10 h-10 rounded-full object-cover mr-3 bg-gray-200" />
                                }
                                else
                                {
                                    <div class="w-10 h-10 rounded-full bg-emerald-100 dark:bg-emerald-900/50 flex items-center justify-center text-emerald-600 dark:text-emerald-300 font-bold mr-3">
                                        @(std.Username.Substring(0,1).ToUpper())
                                    </div>
                                }
                                <div>
                                    <p class="font-bold text-slate-800 dark:text-white">@std.Username</p>
                                    <p class="text-xs text-slate-500">Student</p>
                                </div>
                            </div>
                        }
                         @if(!Model.AllStudents.Any())
                        {
                            <div class="p-8 text-center text-slate-400 text-sm">No students found.</div>
                        }
                    </div>
                </div>
            </div>
        }
        else
        {
            <!-- Standard User View: Courses -->
            @if(Model.TaughtCourses.Any())
            {
                <div class="mb-10">
                    <h2 class="text-xl font-bold text-slate-800 dark:text-white mb-6 border-b border-gray-200 dark:border-slate-700 pb-2">Invested Courses</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        @foreach(var course in Model.TaughtCourses)
                        {
                            <a asp-controller="Courses" asp-action="Details" asp-route-id="@course.Id" class="block bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-gray-200 dark:border-slate-700 hover:border-[#004B87] dark:hover:border-blue-500 transition-colors p-6 group">
                                 <h3 class="font-bold text-lg text-slate-800 dark:text-white group-hover:text-[#004B87] dark:group-hover:text-blue-400 transition-colors">@course.Name</h3>
                                 <p class="text-sm text-slate-500 dark:text-slate-400 font-medium">@course.Code</p>
                            </a>
                        }
                    </div>
                </div>
            }

            <div class="mb-10">
                <h2 class="text-xl font-bold text-slate-800 dark:text-white mb-6 border-b border-gray-200 dark:border-slate-700 pb-2">Enrolled Courses</h2>
                
                @if(!Model.EnrolledCourses.Any())
                {
                     <div class="text-center py-12 bg-gray-50 dark:bg-slate-800/50 rounded-lg border border-dashed border-gray-200 dark:border-slate-700">
                         <p class="text-slate-500 dark:text-slate-400">You are not enrolled in any courses yet.</p>
                     </div>
                }
                else
                {
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        @foreach(var course in Model.EnrolledCourses)
                        {
                            <a asp-controller="Courses" asp-action="Details" asp-route-id="@course.Id" class="block bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-gray-200 dark:border-slate-700 hover:border-[#004B87] dark:hover:border-blue-500 transition-colors p-6 group">
                                 <h3 class="font-bold text-lg text-slate-800 dark:text-white group-hover:text-[#004B87] dark:group-hover:text-blue-400 transition-colors">@course.Name</h3>
                                 <p class="text-sm text-slate-500 dark:text-slate-400 font-medium">@course.Code</p>
                            </a>
                        }
                    </div>
                }
            </div>
        }
        
        <!-- Chat Groups Section (For All Users) -->
        <div>
            <h2 class="text-xl font-bold text-slate-800 dark:text-white mb-6 border-b border-gray-200 dark:border-slate-700 pb-2">My Chat Groups</h2>
            @if(!Model.ChatGroups.Any())
            {
                 <div class="text-center py-8 bg-gray-50 dark:bg-slate-800/50 rounded-lg border border-dashed border-gray-200 dark:border-slate-700">
                     <p class="text-slate-500 dark:text-slate-400">You haven't joined any groups yet.</p>
                     <a asp-controller="Collaboration" asp-action="Index" class="text-[#004B87] dark:text-blue-400 font-bold hover:underline mt-2 inline-block">Browse Groups</a>
                 </div>
            }
            else
            {
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    @foreach(var group in Model.ChatGroups)
                    {
                        <a asp-controller="Collaboration" asp-action="Details" asp-route-id="@group.Id" class="block bg-white dark:bg-slate-800 rounded-lg shadow-sm border border-gray-200 dark:border-slate-700 hover:border-[#004B87] dark:hover:border-blue-500 transition-colors p-6 group h-full">
                             <div class="flex items-center justify-between mb-4">
                                 <div class="w-10 h-10 rounded-lg bg-blue-50 dark:bg-blue-900/20 text-[#004B87] dark:text-blue-400 flex items-center justify-center">
                                     <i data-lucide="@(group.IsDefault ? "building" : "users")" class="w-5 h-5"></i>
                                 </div>
                                 @if(group.IsDefault)
                                 {
                                     <span class="bg-blue-100 text-blue-800 text-[10px] font-bold px-2 py-1 rounded-full uppercase">Official</span>
                                 }
                             </div>
                             <h3 class="font-bold text-lg text-slate-800 dark:text-white group-hover:text-[#004B87] dark:group-hover:text-blue-400 transition-colors">@group.Name</h3>
                             <p class="text-sm text-slate-500 dark:text-slate-400 mt-2 line-clamp-2">@group.Description</p>
                        </a>
                    }
                </div>
            }
        </div>
    </div>
</div>

<script>
    function switchTab(tab) {
        // Tabs
        const tabRecent = document.getElementById('tab-recent');
        const tabShared = document.getElementById('tab-shared');
        const tabAcademic = document.getElementById('tab-academic');
        
        // Content
        const contentRecent = document.getElementById('content-recent');
        const contentShared = document.getElementById('content-shared');
        const contentAcademic = document.getElementById('content-academic');
        
        // Reset all
        [tabRecent, tabShared, tabAcademic].forEach(t => {
            if(t) {
                t.classList.add('text-slate-500', 'dark:text-slate-400', 'border-transparent');
                t.classList.remove('text-[#004B87]', 'dark:text-blue-400', 'border-[#004B87]', 'dark:border-blue-400');
            }
        });
        [contentRecent, contentShared, contentAcademic].forEach(c => {
            if(c) c.classList.add('hidden');
        });

        if (tab === 'recent') {
            contentRecent.classList.remove('hidden');
            tabRecent.classList.add('text-[#004B87]', 'dark:text-blue-400', 'border-[#004B87]', 'dark:border-blue-400');
            tabRecent.classList.remove('text-slate-500', 'dark:text-slate-400', 'border-transparent');
        } else if (tab === 'shared') {
            contentShared.classList.remove('hidden');
            tabShared.classList.add('text-[#004B87]', 'dark:text-blue-400', 'border-[#004B87]', 'dark:border-blue-400');
            tabShared.classList.remove('text-slate-500', 'dark:text-slate-400', 'border-transparent');
        } else {
            contentAcademic.classList.remove('hidden');
            tabAcademic.classList.add('text-[#004B87]', 'dark:text-blue-400', 'border-[#004B87]', 'dark:border-blue-400');
            tabAcademic.classList.remove('text-slate-500', 'dark:text-slate-400', 'border-transparent');
        }
        
        if (typeof lucide !== 'undefined') lucide.createIcons();
    }

    // Auto-show modal if there is feedback
    document.addEventListener('DOMContentLoaded', function() {
        if ("@(TempData["Error"] ?? TempData["Success"])" !== "") {
            document.getElementById('profile-upload-modal')?.classList.remove('hidden');
        }
    });
</script>

<!-- User Settings Modal -->
<div id="profile-upload-modal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center backdrop-blur-sm">
    <div class="bg-white dark:bg-slate-800 rounded-xl shadow-2xl p-6 w-full max-w-lg mx-4 animate-in fade-in zoom-in-95 duration-200 max-h-[90vh] overflow-y-auto">
        <div class="flex justify-between items-center mb-6">
            <h3 class="font-bold text-xl text-slate-800 dark:text-white">User Settings</h3>
            <button onclick="document.getElementById('profile-upload-modal').classList.add('hidden')" class="text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-white">
                <i data-lucide="x" class="w-5 h-5"></i>
            </button>
        </div>
        
        @if(TempData["Error"] != null)
        {
            <div class="mb-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg flex items-start">
                <i data-lucide="alert-circle" class="w-5 h-5 text-red-600 dark:text-red-400 mr-2 flex-shrink-0 mt-0.5"></i>
                <p class="text-sm text-red-800 dark:text-red-200">@TempData["Error"]</p>
            </div>
        }
        
        @if(TempData["Success"] != null)
        {
            <div class="mb-4 p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg flex items-start">
                <i data-lucide="check-circle" class="w-5 h-5 text-green-600 dark:text-green-400 mr-2 flex-shrink-0 mt-0.5"></i>
                <p class="text-sm text-green-800 dark:text-green-200">@TempData["Success"]</p>
            </div>
        }

        
        <form asp-action="UpdateUserSettings" method="post" enctype="multipart/form-data">
            <div class="space-y-6">
                <!-- Profile Picture Section -->
                <div class="pb-6 border-b border-gray-200 dark:border-slate-700">
                    <h4 class="font-bold text-sm text-slate-700 dark:text-slate-300 mb-4 flex items-center">
                        <i data-lucide="image" class="w-4 h-4 mr-2"></i>
                        Profile Picture
                    </h4>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Upload from Computer</label>
                            <input type="file" name="ProfilePictureFile" accept="image/*" class="block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-bold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 dark:file:bg-blue-900 dark:file:text-blue-200" />
                        </div>
                        
                        <div class="relative flex py-2 items-center">
                            <div class="flex-grow border-t border-gray-200 dark:border-slate-700"></div>
                            <span class="flex-shrink-0 mx-4 text-gray-400 text-xs uppercase font-bold">OR</span>
                            <div class="flex-grow border-t border-gray-200 dark:border-slate-700"></div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Image URL</label>
                            <input type="text" name="ProfilePictureUrl" placeholder="https://example.com/image.jpg" class="w-full bg-gray-50 dark:bg-slate-900 border border-gray-300 dark:border-slate-600 text-slate-900 dark:text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5" />
                            <a href="https://www.google.com/search?tbm=isch&q=profile+picture+avatar" target="_blank" class="text-xs text-[#004B87] dark:text-blue-400 hover:underline flex items-center mt-2">
                                <i data-lucide="search" class="w-3 h-3 mr-1"></i> Search Images on Google
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Username Section -->
                <div class="pb-6 border-b border-gray-200 dark:border-slate-700">
                    <h4 class="font-bold text-sm text-slate-700 dark:text-slate-300 mb-4 flex items-center">
                        <i data-lucide="user" class="w-4 h-4 mr-2"></i>
                        Change Username
                    </h4>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">New Username</label>
                        <input type="text" name="NewUsername" autocomplete="off" placeholder="Enter new username (optional)" class="w-full bg-gray-50 dark:bg-slate-900 border border-gray-300 dark:border-slate-600 text-slate-900 dark:text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5" />
                        <p class="text-xs text-slate-500 dark:text-slate-400 mt-1">Leave blank to keep your current username</p>
                    </div>
                </div>

                <!-- Password Section -->
                <div class="pb-6 border-b border-gray-200 dark:border-slate-700">
                    <h4 class="font-bold text-sm text-slate-700 dark:text-slate-300 mb-4 flex items-center">
                        <i data-lucide="lock" class="w-4 h-4 mr-2"></i>
                        Change Password
                    </h4>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">New Password</label>
                            <input type="password" name="NewPassword" autocomplete="new-password" placeholder="Enter new password (optional)" class="w-full bg-gray-50 dark:bg-slate-900 border border-gray-300 dark:border-slate-600 text-slate-900 dark:text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5" />
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Confirm New Password</label>
                            <input type="password" name="ConfirmNewPassword" autocomplete="new-password" placeholder="Confirm new password" class="w-full bg-gray-50 dark:bg-slate-900 border border-gray-300 dark:border-slate-600 text-slate-900 dark:text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5" />
                            <p class="text-xs text-slate-500 dark:text-slate-400 mt-1">Leave both blank to keep your current password</p>
                        </div>
                    </div>
                </div>

                <!-- Current Password Verification -->
                <div>
                    <h4 class="font-bold text-sm text-slate-700 dark:text-slate-300 mb-4 flex items-center">
                        <i data-lucide="shield-check" class="w-4 h-4 mr-2"></i>
                        Verify Changes
                    </h4>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                            Current Password
                            <span class="text-red-500">*</span>
                        </label>
                        <input type="password" name="CurrentPassword" autocomplete="current-password" placeholder="Required for username/password changes" class="w-full bg-gray-50 dark:bg-slate-900 border border-gray-300 dark:border-slate-600 text-slate-900 dark:text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5" />
                        <p class="text-xs text-slate-500 dark:text-slate-400 mt-1">Required only if changing username or password</p>
                    </div>
                </div>
            </div>
            
            <div class="mt-8 flex justify-end space-x-3">
                 <button type="button" onclick="document.getElementById('profile-upload-modal').classList.add('hidden')" class="px-4 py-2 rounded-lg text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 font-medium transition-colors">Cancel</button>
                 <button type="submit" class="px-6 py-2 rounded-lg bg-[#004B87] hover:bg-[#003d6e] text-white font-bold shadow-md transition-colors">Save Changes</button>
            </div>
        </form>
    </div>
</div>
</div>

<!-- Scripts for Feed Interactions -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/6.0.1/signalr.js"></script>
<script src="~/js/feed.js" asp-append-version="true"></script>
